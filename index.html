<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>QTickets WebApp</title>
    <style>
        html, body, #frame {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
        }
    </style>
    <script>
        const tg = window.Telegram?.WebApp;
        window.addEventListener('DOMContentLoaded', () => {
            if (tg) tg.ready();

            // 1) Получаем payload из ?startapp или initDataUnsafe
            const payload = new URLSearchParams(location.search)
                    .get('startapp')
                || tg?.initDataUnsafe?.start_param
                || '';
            if (!payload) {
                document.body.innerHTML = '<p style="color:red; text-align:center;">Нет startapp</p>';
                return;
            }

            // 2) Разбиваем по '-' на куски
            const segments = payload.split('-');
            // 3) Первый сегмент — это eventId
            const eventId = segments.shift();
            if (!eventId) {
                document.body.innerHTML = '<p style="color:red; text-align:center;">Нет event_id</p>';
                return;
            }

            // 4) Остальные сегменты — в формате key=value
            const params = new URLSearchParams();
            segments.forEach(seg => {
                const [key, value] = seg.split('=');
                if (key && value != null) {
                    params.set(key, value);
                }
            });

            // 5) Строим URL для iframe
            const qs = params.toString();
            const src = `https://qtickets.ru/event/${encodeURIComponent(eventId)}/${ qs ? `?${qs}` : '' }`;

            // 6) Вставляем iframe
            const iframe = document.createElement('iframe');
            iframe.id = 'frame';
            iframe.src = src;
            iframe.frameBorder = '0';
            document.body.appendChild(iframe);
        });
    </script>
</head>
<body></body>
</html>