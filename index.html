<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Открываю QTickets…</title>
    <!-- Запрет кэширования -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma"        content="no-cache">
    <meta http-equiv="Expires"       content="0">
    <style>
        body { margin:0; display:flex; justify-content:center; align-items:center;
            height:100vh; font-family:sans-serif }
    </style>
    <script>
        (function () {
            const search = new URLSearchParams(location.search);
            const hash   = location.hash || '';

            // 1) Берём чистый eventId
            const eventId = search.get('startapp');
            if (!eventId) {
                document.body.textContent = 'startapp должен быть указан';
                return;
            }

            // 2) Готовим параметры для запроса к Qtickets
            const params = new URLSearchParams();
            params.set('tgWebAppStartParam', eventId);
            params.set('event_id',            eventId);

            // 3) Копируем utm_* из исходного URL (если они есть)
            for (const [k, v] of search.entries()) {
                if (k.startsWith('utm_') && v) {
                    params.set(k, v);
                }
            }

            // 4) Добавляем «cache buster» на случай, если нужно
            params.set('_cb', Date.now());

            // 5) Формируем конечный URL
            const dest = `https://qtickets.ru/telegram-iframe?${params}${hash}`;

            // 6) Переходим без новой истории (чтобы WebApp остался в том же контексте)
            location.replace(dest);
        })();
    </script>
</head>
<body>
<p>Загружаем QTickets…</p>
</body>
</html>