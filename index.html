<!doctype html><html lang="ru"><head>
    <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redirect…</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma"        content="no-cache">
    <meta http-equiv="Expires"       content="0">
    <script>
        (function (){
            const p     = new URLSearchParams(location.search);
            const raw   = p.get('startapp') || p.get('tgWebAppStartParam');
            if(!raw){document.body.textContent='startapp missing';return;}

            const [eventId, b64=''] = raw.split('_',2);

            /* ↓ base64url → JSON → объект */
            let utm = {};
            if(b64){
                const pad = b64.length%4? '='.repeat(4-b64.length%4):'';
                const json = atob(b64.replace(/-/g,'+').replace(/_/g,'/')+pad);
                try{ utm = JSON.parse(json); }catch(e){}
            }

            const q = new URLSearchParams({ tgWebAppStartParam:eventId, event_id:eventId, _cb:Date.now() });
            if(utm.s) q.set('utm_source',   utm.s);
            if(utm.m) q.set('utm_medium',   utm.m);
            if(utm.c) q.set('utm_campaign', utm.c);
            if(utm.t) q.set('utm_term',     utm.t);
            if(utm.o) q.set('utm_content',  utm.o);

            location.replace(`https://qtickets.ru/telegram-iframe?${q}${location.hash||''}`);
        })();
    </script></head><body></body></html>