<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Открываю QTickets…</title>

    <!-- Запрет кэширования -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma"        content="no-cache">
    <meta http-equiv="Expires"       content="0">

    <style>
        body{margin:0;display:flex;justify-content:center;align-items:center;
            height:100vh;font-family:sans-serif}
    </style>

    <script>
        (function () {
            /** исходный ?tgWebAppStartParam=168624-utm_source=telegram-utm_medium=ref-... */
            const q    = new URLSearchParams(location.search);
            const hash = location.hash || '';

            const raw = q.get('tgWebAppStartParam');
            if (!raw){ document.body.textContent='tgWebAppStartParam отсутствует'; return; }

            /* разбираем */
            const segments = raw.split('-');
            const eventId  = segments.shift();              // 168624

            /* формируем query-набросок */
            const p = new URLSearchParams();
            p.set('tgWebAppStartParam', raw);               // ← оставляем как было
            p.set('event_id',            eventId);          // ← явный id события

            /* переносим UTM-пары в «чистом» виде */
            segments.forEach(seg=>{
                const [k,...rest]=seg.split('=');
                const v = rest.join('=');
                if(k && v) p.set(k, v);                      // utm_source / medium / ...
            });

            /* кеш-бастер, чтобы WebView точно не закешировал */
            p.set('_cb', Date.now());

            const target = `https://qtickets.ru/telegram-iframe?${p}${hash}`;

            /* переходим без создания лишней истории */
            location.replace(target);
        })();
    </script>
</head>
<body>
<p>Загружаем кассу QTickets…</p>
</body>
</html>